<html><head><link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-location/iron-location.html">
<link rel="import" href="../bower_components/iron-location/iron-query-params.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="dollar-rating.html">
<link rel="import" href="star-rating.html">

</head><body><dom-module id="search-results">

  <template>

    <style include="iron-flex iron-flex-alignment">:host{--paper-card:{width:100%;};}*[hidden]{display:none !important;}#noResults{text-align:center;}.loader{display:flex;flex-direction:column;align-items:center;justify-content:center;margin-top:2em;}.storeImage{width:15em;height:10em;}.card-header:{@apply (--paper-font-headline);};paper-card{border-bottom:1px solid var(--paper-grey-400);}.shopCard a{color:black;text-decoration:none;}.shopCard{color:black;}.shopCard:hover{cursor:pointer;}.card-detail{color:var(--paper-grey-600);}.row{@apply (--layout-horizontal);@apply (--layout-center);@apply (--layout-justified);}.row > *{padding:10px;}.row *:nth-child(1){flex:1 1 25%;align-self:auto;}.row *:nth-child(2){flex:4 1 50%;align-self:auto;}.row *:nth-child(3){flex:0 1 25%;align-self:auto;}@media screen and (max-width: 767px){.row{@apply (--layout-wrap);}}</style>

    <app-route route="{{route}}" query-params="{{queryParams}}">
    </app-route>

    <section hidden$="[[loading]]">
      <h3 id="noResults" hidden$="[[!emptyResults]]">No Results Found</h3>
      <div hidden$="[[emptyResults]]">
        <template is="dom-repeat" items="[[_displayedResults]]" as="shop">
          <a class="shopCard" href="/#/business/{{shop.placeId}}">
            <paper-card on-tap="setBusiness">
              <div class="card-content">
                <div class="row">
                  <img class="storeImage" src="[[shop.image]]" alt="restaurant picture">
                  <div>
                    <h3>[[shop.title]]</h3>
                    <star-rating rating="[[shop.rating]]"></star-rating>
                  </div>
                  <div>
                    <p class="card-detail">[[shop.address]]</p>
                    <dollar-rating rating="[[shop.price]]"></dollar-rating>
                  </div>
                </div>
              </div>
            </paper-card>
          </a>
          <br>
        </template>
      </div>
    </section>

    <section class="loader" hidden$="[[!loading]]">
      <paper-spinner active="[[!loading]]"></paper-spinner>
    </section>

  </template>

  <script>Polymer({is:"search-results",properties:{route:{type:Object,notify:!0},data:{type:Object},active:{type:Boolean,notify:!0,value:!1},queryParams:{type:Object,notify:!0},business:{type:Object,notify:!0},_displayedResults:{type:Array,notify:!0,value:function(){return[]}},searchResults:{type:Array,notify:!0,value:function(){return[]}},map:{type:Object},coords:{},emptyResults:{type:Boolean,notify:!0,value:!0},openNow:{type:Boolean},maxPrice:{type:Number},minPrice:{type:Number},radius:{type:Number},loading:{type:Boolean,value:!1},openFilter:{type:Boolean},minFilter:{type:Number},maxFilter:{type:Number}},observers:["_textSearch(active, queryParams.search, coords, minPrice, maxPrice, radius)","_filterResults(searchResults, openFilter, minFilter, maxFilter)"],setBusiness:function(e){this.business=e.model.shop},_fetchImageUrl:function(e){return imageUrl=e.getUrl({maxWidth:1e3,maxHeight:500}),imageUrl},_filterResults:function(e,t,s,i){void 0!==e&&0!=e.length&&(filtered=e.filter(function(e){return e.openNow==t&&s<=e.price&&e.price<=i}),0==filtered.length?(this.emptyResults=!0,this._displayedResults=filtered):(this.emptyResults=!1,this._displayedResults=filtered))},_textSearch:function(e,t,s,i,r,a){var n=this;if(e&&t&&s){this.loading=!0;var l=new google.maps.Map(this.map,{center:s}),o={location:s,minPriceLevel:i,maxPriceLevel:r,query:t,radius:a,type:"restaurant"};void 0!==this.openNow&&(o.openNow=this.openNow);var p=new google.maps.places.PlacesService(l);p.textSearch(o,function(e,t){if(t==google.maps.places.PlacesServiceStatus.OK){n.emptyResults=!1;var s=e.splice(0,10);n.parseResults(s),n.loading=!1}else n.emptyResults=!0,n.loading=!1})}},parseResults:function(e){var t=this;this.searchResults=e.map(function(e){var s=e.name,i=e.opening_hours.open_now,r=e.price_level,a=e.formatted_address,n=e.rating,l=e.place_id,o=e.photos||"https://maps.gstatic.com/tactile/pane/result-no-thumbnail-2x.png",p="string"==typeof o?o:t._fetchImageUrl(o[0]);return{title:s,openNow:i,price:r,address:a,rating:n,image:p,placeId:l}})}});</script>

</dom-module>
</body></html>