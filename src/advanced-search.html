<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-validatable-behavior/iron-validatable-behavior.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="places-input.html">
<link rel="import" href="valid-form.html">


<dom-module id="advanced-search">

  <template>

    <style>
     :host {
         --valid-form-button: {
             border-radius: 25%;
             background-color:  #FFE05C;
             flex: 0 1 auto;
             width: 10%;
             /* padding-left: ; */
         }

         --valid-form-form: {
             background-color: white !important;
             flex-wrap: wrap;
             flex-direction: column;
             width: 80%;
         }
     }

     .card {
         box-shadow: 0 2px 2px 0  rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
         padding: 16px;
         margin: 24px;
         border-radius: 5px;
         background-color: #fff;
         width: 80%;
     }

     paper-slider {
         margin-top: 0 !important;
     }

     paper-input, places-input, paper-toggle-button, paper-slider {
         width: 75%;
         margin: 1em;
     }

    </style>

    <app-route route="{{route}}" query-params="{{queryParams}}">
    </app-route>

    <paper-card class="card">
      <valid-form id="advSearchForm" button="Search">
        <h3>Advanced Search</h3>

        <paper-input label="Business Name or Food Type"
                     ariaLabel="Business Name or Food Type"
                     value="{{queryParams.search}}"
                     required></paper-input>

        <places-input value="{{location}}"
                      lat="{{latitude}}"
                      lng="{{longitude}}"
                      label="Location"
                      aria-label="Location"
                      required></places-input>

        <paper-toggle-button value="{{openNow}}">Open Now</paper-toggle-button>

        <label for="minPriceFilter">Minimum Price</label>
        <paper-slider id="minPriceFilter"
                      aria-label="Minimum Price"
                      value="{{lowPrice}}"
                      min="1"
                      max="5"
                      required
                      editable></paper-slider>

        <label for="maxPriceFilter">Maximum Price</label>
        <paper-slider id="maxPriceFilter"
                      aria-label="Maximum Price"
                      value="{{highPrice}}"
                      min="1"
                      max="5"
                      required
                      editable></paper-slider>

        <label for="radiusFilter">Search Radius (in kilometers)</label>
        <paper-slider id="radiusFilter"
                      aria-label="Search Radius (in kilometers)"
                      value="{{kmRadius}}"
                      min="1"
                      max="10"
                      editable></paper-slider>
      </valid-form>
    </paper-card>
  </template>

  <script>

   Polymer({

     is: 'advanced-search',

     behaviors: [
       Polymer.IronValidatableBehavior
     ],

     properties: {
       route: {
         type: Object,
         notify: true
       },

       queryParams: {
         type: Object,
         notify: true
       },

       location: {
         type: String,
         notify: true
       },

       latitude: {
         type: Number,
         notify: true
       },

       longitude: {
         type: Number,
         notify: true
       },

       openNow: {
         type: Boolean,
         notify: true
       },

       /* The prices for google places are from 0 to 4 but visually,
          the dollar signs are 1 to 5. Using low and highPrices for a
          1 to 5 range.
        */
       lowPrice: {
         type: Number,
         value: 1
       },

       highPrice: {
         type: Number,
         value: 5
       },

       minPrice: {
         type: Number,
         notify: true
       },

       maxPrice: {
         type: Number,
         notify: true
       },

       kmRadius: {
         type: Number,
         value: 10
       },

       radius: {
         type: Number,
         notify: true
       }

     },

     listeners: {
       'advSearchForm.iron-form-submit': '_textSearch'
     },

     observers: [
       'setMin(highPrice)',
       'setMax(lowPrice)',
       'setRadius(kmRadius)'
     ],

     setMax: function(low) {
       if (this.highPrice < low) {
         this.highPrice = low;
         console.log(this.highPrice);
       };

       this.maxPrice = this.highPrice - 1;
     },

     setMin: function(high) {
       if (high < this.lowPrice) {
         this.lowPrice = high;
         console.log(this.lowPrice);
       };

       this.minPrice = this.lowPrice - 1;
     },

     setRadius: function(kmRadius) {
       this.radius = kmRadius * 1000;
     },

     // jump to the search-results page
     _textSearch: function() {
       this.set('route.path', '/search');
     }

   });
  </script>

</dom-module>
