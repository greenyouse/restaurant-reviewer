<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="restaurant-card.html">

<dom-module id="home-page">
  <template>

    <style>
     .nearbyTable {
         @apply(--layout-horizontal);
         @apply(--layout-center-justified);
         @apply(--layout-wrap);
     }

     .nearbyTable > * {
         padding: .5em;
         width: 10em;
         height: 20em;
     }

     .center {
         text-align: center;
     }

     .categories {
         @apply(--layout-horizontal);
         @apply(--layout-center-justified);
         @apply(--layout-wrap);
     }

     .categories > * > * {
         list-style: none;
         color: var(--google-blue-500);
     }

     .categories > * > *:hover {
         cursor: pointer;
     }

     a {
         color: black;
         text-decoration: none;
     }

     a:focus {
         outline: 1px solid black;
     }

    </style>

    <section>

      <h3 class="center">Nearby Restaurants</h3>
      <div class="nearbyTable">
        <template is="dom-repeat" items="[[nearbyPlaces]]" as="shop">
          <a href="/#/business/{{shop.place_id}}">
            <restaurant-card title=[[shop.name]]
                             image-data=[[shop.photos]]
                             rating=[[shop.rating]]
                             open-now=[[shop.opening_hours.open_now]]
                             place-id="[[shop.place_id]]"
                             address=[[shop.vicinity]]
                             on-tap="setBusiness">
            </restaurant-card>
          </a>
        </template>
      </div>
      <br>

      <h3 class="center">Cuisine Types</h3>
      <section class="categories">
        <ul>
          <li><a on-tap="setSearch" href="#">BBQ</a></li>
          <li><a on-tap="setSearch" href="#">Ethnic</a></li>
          <li><a on-tap="setSearch" href="#">Cafe</a></li>
          <li><a on-tap="setSearch" href="#">Chinese</a></li>
        </ul>
        <ul>
          <li><a on-tap="setSearch" href="#">Coffeehouse</a></li>
          <li><a on-tap="setSearch" href="#">Family Style</a></li>
          <li><a on-tap="setSearch" href="#">Fast Food</a></li>
          <li><a on-tap="setSearch" href="#">French</a></li>
        </ul>
        <ul>
          <li><a on-tap="setSearch" href="#">Fine Dining</a></li>
          <li><a on-tap="setSearch" href="#">Japanese</a></li>
          <li><a on-tap="setSearch" href="#">Latin American</a></li>
          <li><a on-tap="setSearch" href="#">Middle Eastern</a></li>
        </ul>
        <ul>
          <li><a on-tap="setSearch" href="#">Pizza</a></li>
          <li><a on-tap="setSearch" href="#">Spanish</a></li>
          <li><a on-tap="setSearch" href="#">Soul food</a></li>
          <li><a on-tap="setSearch" href="#">Tex-Mex</a></li>
        </ul>
      </section>

      <!-- fake google map element for the Google Places library -->
      <div id="map"></div>
    </section>

  </template>

  <script>
   Polymer({

     is: 'home-page',

     properties: {
       coords: {},

       business: {
         type: Object,
         notify: true
       },

       nearbyPlaces: {
         type: Array
       },

       searchTerm: {
         type: String,
         notify: true
       },

       submit: {
         type: Boolean,
         notify: true
       }

     },

     observers: [
       'fetchPlaces(coords)'
     ],

     setBusiness: function(e) {
       this.business = e.model.shop;
     },

     setSearch: function(e) {
       var businessName = e.detail.sourceEvent.target.innerText;

       this.searchTerm = businessName;
       this.submit = true;
     },

     /**
      * Loads an array of nearby restaurants
      * @param {Array} coords The lat/lng coordinates to use
      */
     fetchPlaces: function(coords) {
       var _this = this;

       var map = new google.maps.Map(this.$.map, {
         center: coords
       });

       var request = {
         location: coords,
         radius: '10000',
         types: ['restaurant']
       };

       var places = new google.maps.places.PlacesService(map);

       places.nearbySearch(request, function (resp, status) {
         if (status == google.maps.places.PlacesServiceStatus.OK) {

           // try to only include restaurants with pictures
           var shops = resp.filter(function (s) {
             return s.photos;
           });

           shops = shops.splice(0,4);
           _this.nearbyPlaces = shops;
         }
       });
     }

   });
  </script>

</dom-module>
